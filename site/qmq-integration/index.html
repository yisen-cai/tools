
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>集成QMQ</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="qmq-integration"
                  title="集成QMQ"
                  environment="web"
                  feedback-link="https://glancebar.com">
    
      <google-codelab-step label="预览" duration="1">
        <p>qmq是一个...</p>
<h2 is-upgraded>你将学会:</h2>
<ul>
<li>接入QMQ</li>
<li>创建简单消息并消费</li>
<li>如何在管理后台管理和查看消息</li>
<li>其他高级内容</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="基础配置" duration="2">
        <p>在此之前, 请先配置下qunar认证中心的相关内容, 参考...</p>
<h2 is-upgraded>添加依赖包</h2>
<p>TC公共组件可在 <a href="http://nexus.corp.qunar.com/nexus/#view-repositories;releases~browsestorage~qunar/tc/tcdev" target="_blank">Qunar Release Repository</a> 查找</p>
<pre><code language="language-xml" class="language-xml">&lt;!-- TC公共组件pom --&gt;
&lt;dependencyManagement&gt;
   &lt;dependencies&gt;
        &lt;dependency&gt;
        &lt;groupId&gt;qunar.tc&lt;/groupId&gt;
        &lt;artifactId&gt;tcdev&lt;/artifactId&gt;
        &lt;version&gt;最新版本&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencyManagement&gt;

&lt;!-- qmq相关依赖 --&gt;
&lt;dependencies&gt;
	  &lt;dependency&gt;
        &lt;groupId&gt;qunar.tc&lt;/groupId&gt;
        &lt;artifactId&gt;qmq-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<h2 is-upgraded>验证下有效性</h2>
<p>之后可以点击IDEA中Maven刷新按钮, 或者使用命令行去下载安装依赖, 验证配置的正确性.</p>
<pre><code language="language-bash" class="language-bash"># 跳过测试, 下载依赖并构建项目
$ mvn clean install -DskipTests=true
</code></pre>
<p>没问题之后进行下一步.</p>


      </google-codelab-step>
    
      <google-codelab-step label="创建&amp;消费消息" duration="3">
        <h2 is-upgraded>创建基础组件</h2>
<pre><code language="language-java" class="language-java">/**
  * 使用配置类来创建基础组件Bean
  */
@Configuration
public class QmqConfig {
    /**
      * 也可以在xml文件中创建
      */
    @Bean
    public MessageProducerProvider messageProducerProvider() {
        return new MessageProducerProvider();
    }
}
</code></pre>
<h2 is-upgraded>创建生产者</h2>
<pre><code language="language-java" class="language-java">@Component
public class DemoProducer {
    private final MessageProducerProvider producer;
  
    /**
      * 使用构造器注入依赖
      */
    public DemoProducer(MessageProducerProvider provider) {
        this.producer = provider;
    }
  
    /**
     * 生产简单的消息
     */
    public void generateDemo(String demoName) {
       // 创建一个主题消息, 主题为qunar.train.demo
        Message message = producer.generateMessage(&#34;qunar.train.demo&#34;); 
        // 设置一个demoName的属性, value是传入的
        message.setProperty(&#34;demoName&#34;, demoName);
        producer.sendMessage(message);
    }
}
</code></pre>
<h2 is-upgraded>消费者</h2>
<pre><code language="language-java" class="language-java">@Component
public class DemoConsumer {
    private Logger logger = LoggerFactory.getLogger(DemoConsumer.class);

    /**
      * 使用注解注册消费者,onMessage作为一个回调进行消费数据
      */
    @QmqConsumer(prefix = &#34;qunar.train.demo&#34;, consumerGroup = &#34;demo&#34;)
    public void onMessage(Message message) {
        String demoName = message.getStringProperty(&#34;demoName&#34;);
        logger.info(&#34;--------------------{}---------------------&#34;, demoName);
    }
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="验证效果" duration="0">
        <p>...</p>


      </google-codelab-step>
    
      <google-codelab-step label="管理后台使用" duration="1">
        <h2 is-upgraded>Hyperlinking</h2>
<p><a href="https://www.youtube.com/user/iamhalsey/playlists" target="_blank">Youtube - Halsey Playlists</a></p>
<h2 is-upgraded>Images</h2>
<p class="image-container"><img alt="alt-text-here" src="img/fe9b0c37b30849ce.jpg"></p>


      </google-codelab-step>
    
      <google-codelab-step label="其他内容" duration="1">
        <p>高级点的使用教程</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
